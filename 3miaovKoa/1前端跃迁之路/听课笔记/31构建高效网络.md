在 TCP 传输过程中，由于单个数据包的丢失而造成的阻塞称为 TCP 上的队头阻塞。

## TCP 建立连接的延时
先科普一个概念：网络延迟

- 什么是网络延迟？
网络延迟又称为 RTT。我们把从浏览器发送一个数据包到服务器，再从服务器返回数据包到浏览器的整个往返时间称为 RTT。

- 建立TCP连接时，需要花费多少个RTT？
1、在建立 TCP 连接的时候，需要和服务器进行三次握手来确认连接成功，也就是说需要在消耗完 1.5 个 RTT 之后才能进行数据传输。
2、进行 TLS 连接，TLS 有两个版本——TLS1.2 和 TLS1.3，每个版本建立连接所花的时间不同，大致是需要 1～2 个 RTT。

所以总的来说，需要花掉3～4 个RTT。如果浏览器和服务器的物理距离比较近，那么1个RTT大概需要10ms；如果浏览器和服务器的物理距离比较远，那么1个RTT大概需要100ms；这种情况下整个握手过程大概300-400ms。


## 如何解决队头阻塞和建立连接延迟问题？
在TCP协议上做优化非常困难，因为TCP协议存在中间设备的僵化。

- 什么是中间设备？
互联网是由多个网络互联的网状结构，为了能够保障互联网的正常工作，我们需要在互联网的各处搭建各种设备，这些设备就被称为中间设备。

- 什么是中间设备的僵化？
这些设备比如：路由器、防火墙、NAT、交换机等。但是这些机器依赖一些很少升级的软件。如果在客户端升级了TCP协议，这些软件就会不兼容。

另一个导致TCP协议僵化的原因是操作系统。因为TCP协议都是通过操作系统内核来实现的，应用程序只能使用不能修改。


## QUIC 协议（完全脱离了TCP协议的限制）
在TCP协议上做优化非常困难，那么要优化就引入了一种新的协议：QUIC协议。

QUIC协议是基于UDP协议改造的。

QUIC协议有以下几点功能：
1、实现了类似 TCP 的流量控制、传输可靠性的功能。
2、集成了 TLS 加密功能。
3、实现了 HTTP/2 中的多路复用功能。解决了TCP中队头阻塞的问题。
4、实现了快速握手功能。由于是基于UDP的，所以QUIC可以实现使用0-RTT或者1-RTT来建立连接。


## HTTP/3的问题
1、目前主流浏览器对HTTP/3的支持仍然不是很好。
2、部署HTTP/3存在着非常大的问题。因为系统内核对 UDP 的优化远远没有达到 TCP 的优化程度。



