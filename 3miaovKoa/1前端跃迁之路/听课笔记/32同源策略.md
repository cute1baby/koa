## 为什么有同源策略？
如果没有同源策略。整个网络世界是开放的，数据没有隐私，网页之间数据之间互相访问，比如一些银行信息、密码等隐私信息难以被保护。


## 什么是同源策略？
如果两个 URL 的协议、域名和端口都相同，我们就称这两个URL同源。浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的。



## 同源下的网页能做什么？

### 1、DOM层面
限制了来自不同源的 JavaScript 脚本对当前 DOM 对象读和写的操作。页面A打开页面B，如果这两个页面同源，那么可以通过下面操作在页面B下控制页面A的显示隐藏
```
let pdom = opener.document
pdom.body.style.display = "none"
```

### 2、数据层面
同源下的页面的Cookie、IndexDB、LocalStorage等数据可以相互访问。


### 3、网络层面
同源策略限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点。这就是请求跨域的来源。


为了让Web项目开发和使用更加简单，浏览器出让以下的安全性来满足灵活性。


## 出让的安全性方面

### 1、页面中可以嵌入第三方资源
如有一些资源是部署到不同的cdn上的，但是浏览器支持外部引入资源文件。

如果外部的cdn地址是一段恶意的链接地址。页面启动时，恶意脚本能够读取该网站的Cookie 数据。
于是，浏览器中引入了内容安全策略，称为 CSP。CSP 的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码。

通过以上手段可以大大减少 XSS 攻击（跨域注入脚本）。


### 2、跨域资源共享和跨文档消息机制
同源策略会阻止其他源下的请求。
这时候引入了跨域资源共享（CORS），该机制可以进行跨域访问控制，从而使跨域数据传输得以安全进行。

为了实现不同源之间进行前端的通信，浏览器中又引入了【跨文档消息机制】，可以通过 window.postMessage实现通信目的。


## 总结一下
同源策略、CSP 和 CORS 之间的关系：

同源策略就是说同源页面随你瞎搞，但是不同源之间想瞎搞只能通过浏览器提供的手段来搞

比如说
1. 读取数据和操作 DOM 要用跨文档消息机制
2. 跨域请求要用 CORS 机制
3. 引用第三方资源要用 CSP