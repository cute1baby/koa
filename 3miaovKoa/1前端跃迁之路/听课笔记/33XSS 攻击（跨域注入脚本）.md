XSS:是一种通过跨域注入脚本的方式达到攻击网站的目的。

## 恶意脚本能做什么？
- 窃取 Cookie 信息。通过“document.cookie”获取 Cookie 信息，再将信息发给恶意服务器
- 监听用户行为。使用addEventListener监听键盘事件，比如可以获取用户输入的信用卡等信息，再发送到恶意服务器。
- 通过修改 DOM 伪造假的登录窗口。欺骗用户输入用户名和密码等信息。
- 在页面内生成浮窗广告。


## 恶意脚本是怎么注入的
有存储型XSS攻击、反射型XSS攻击和基于DOM的XSS攻击这三种攻击方式。

### 1. 存储型 XSS 攻击
- 首先黑客利用站点漏洞将一段恶意JavaScript代码提交到网站的数据库中；
- 然后用户向网站请求包含了恶意JavaScript脚本的页面，恶意代码展示在页面中；
- 当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到恶意服务器，并将数据保存。

核心将cookies等信息通过url跳转的方式跳转到恶意服务器并保存。

### 2. 反射型 XSS 攻击
关键是在对接口请求注入一些攻击型代码，然后将代码返回给页面。因此恶意代码通过这样的方式进入到了页面中。

### 3. 基于 DOM 的 XSS 攻击
核心是：黑客通过各种手段将恶意脚本注入用户的页面中，如通过网络劫持在页面传输过程中修改HTML页面的内容。如通过WiFi路由器劫持，本地恶意软件来劫持等。



## 如何阻止XSS攻击
存储型 XSS 攻击和反射型 XSS都需要经过Web服务器来处理，可以认为这两种类型的漏洞是服务端的安全漏洞。
而基于 DOM 的 XSS 攻击全部都是在浏览器端完成的，因此基于 DOM 的 XSS 攻击是属于前端的安全漏洞。

共同点是：往浏览器中注入恶意脚本，再通过恶意脚本将用户信息发送至黑客部署的恶意服务器上。

可以通过阻止恶意 JavaScript 脚本的注入和恶意消息的发送来实现。有以下几种方式：

### 1、服务器对输入脚本进行过滤或转码
在服务器端将一些关键的字符进行转码。比如：
```
code:<script>alert('你被xss攻击了')</script>
```
=>
```
code:
```

### 2、充分利用 CSP
实施严格的 CSP 可以有效地防范 XSS 攻击。

具体的CSP有如下几个功能：

- 限制加载其他域下的资源文件，这样即使黑客插入了一个 JavaScript 文件，这个 JavaScript 文件也是无法被加载的；
- 禁止向第三方域提交数据，这样用户数据也不会外泄；
- 禁止执行内联脚本和未授权的脚本；
- 还提供了上报机制，这样可以帮助我们尽快发现有哪些 XSS 攻击，以便尽快修复问题。


### 3. 使用HttpOnly属性
很多 XSS 攻击都是来盗用 Cookie 的，因此还可以通过使用HttpOnly 属性来保护我们 Cookie 的安全。

设置之后就无法通过JavaScript来读取这段Cookie。



## 思考
- 几个岗位对安全性的职责？
除去架构不谈，就产品、后端、前端、测试而言。
产品：
1.业务逻辑层面安全验证，保证即使被攻击也要尽量避免或减少损失，如：资金转出、敏感信息操作（修改登录密码、支付密码）等
后端：
1.存储型和反射性XSS，后端占比较大，考虑到可以通过接口绕过前端，所以内容编码后端处理比较可靠。
2.重点头信息返回httponly，这也需要后端实现
前端：
1.基于 DOM 的 XSS 攻击，CSP等前端技术运用，这边主要是前端
测试：
1.丰富测试框架，正对输入框：长度、类型、是否为空、是否重复、组成范围外，也应了解学习安全性测试：XSS攻击、Sql注入等攻击类型。
总体而言，个人觉得前端在XSS攻击中责任占比不大。


前端对于CSP的设置
```
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">
```

csp的文档说明：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP
