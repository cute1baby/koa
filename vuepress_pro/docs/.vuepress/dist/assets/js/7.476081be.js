(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{358:function(e,a,t){"use strict";t.r(a);var r=t(23),n=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"记录七牛如何使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#记录七牛如何使用"}},[e._v("#")]),e._v(" 记录七牛如何使用")]),e._v(" "),t("h2",{attrs:{id:"参考文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[e._v("#")]),e._v(" 参考文档")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("进入七牛云官网并登录自己的账号")])]),e._v(" "),t("li",[t("p",[e._v("进入"),t("code",[e._v("文档")]),e._v("的类目，进入"),t("code",[e._v("开发者中心")])])]),e._v(" "),t("li",[t("p",[e._v("点击"),t("code",[e._v("对象存储")]),e._v("，点击"),t("code",[e._v("SDK&工具")]),e._v("的类目，进入"),t("code",[e._v("官方SDK")]),e._v("。")])]),e._v(" "),t("li",[t("p",[e._v("选择"),t("code",[e._v("Node.js(服务端)")]),e._v("，进入"),t("code",[e._v("文档")]),e._v("。"),t("a",{attrs:{href:"https://developer.qiniu.com/kodo/sdk/1289/nodejs",target:"_blank",rel:"noopener noreferrer"}},[e._v("文档链接"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[e._v("七牛云文件上传的例子："),t("a",{attrs:{href:"http://wechat.familyli.cn/uploadFile.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("点这里"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[e._v("例子的项目链接：https://github.com/cute1baby/koa/tree/master/wechat-link/js")])])]),e._v(" "),t("h2",{attrs:{id:"定义上传文件的方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定义上传文件的方法"}},[e._v("#")]),e._v(" 定义上传文件的方法")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/cute1baby/koa/blob/master/wechat/public/day02/04/server/qiniu/index.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用参考例子"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_1、引入七牛模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、引入七牛模块"}},[e._v("#")]),e._v(" 1、引入七牛模块")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const qiniu = require('qiniu')\n")])])]),t("h3",{attrs:{id:"_2、获取秘钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、获取秘钥"}},[e._v("#")]),e._v(" 2、获取秘钥")]),e._v(" "),t("p",[e._v("进入七牛云的"),t("code",[e._v("个人中心")]),e._v("，在密钥管理就可以看到AccessKey/SecretKey模块")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var accessKey = 'OTo8RiOd59WRc7WQOyxtGPkY2-eEE3Vgi6ly71-W';\nvar secretKey = 'Vo-SEQ2Mi_SvspVnLzGgPGeG77JeP00Tx37Dj3rD';\n")])])]),t("h3",{attrs:{id:"_3、定义鉴权对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、定义鉴权对象"}},[e._v("#")]),e._v(" 3、定义鉴权对象")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var mac = new qiniu.auth.digest.Mac(accessKey, secretKey);\n")])])]),t("h3",{attrs:{id:"_4、构建bucketmanager对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、构建bucketmanager对象"}},[e._v("#")]),e._v(" 4、构建BucketManager对象")]),e._v(" "),t("p",[e._v("参考文档连接：https://developer.qiniu.com/kodo/sdk/1289/nodejs#7")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 点击[资源管理]部分，构建BucketManager对象\nvar config = new qiniu.conf.Config();\n\n// 设置存储区域。这里的Zone_z0对应华东，可以进行配置，参考以下链接：https://developer.qiniu.com/kodo/manual/1671/region-endpoint\nconfig.zone = qiniu.zone.Zone_z0;\n\n// bucketManager对象上就有所有的方法\nvar bucketManager = new qiniu.rs.BucketManager(mac, config);\n")])])]),t("h3",{attrs:{id:"_5、定义上传文件方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、定义上传文件方法"}},[e._v("#")]),e._v(" 5、定义上传文件方法")]),e._v(" "),t("p",[e._v("[资源管理，抓取网络资源到空间]（即直接通过url上传到七牛云，不需要下载）。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// upload.js\nmodule.exports = (resUrl, key) => {\n    return new Promise((resolve, reject) => {\n            /**\n         * resUrl: 网络资源储存\n         * bucket： 存储空间名称\n         * key: 重命名网络资源的名称\n         */\n        // var resUrl = 'http://devtools.qiniu.com/qiniu.png';\n        var bucket = \"cdn-self\";\n        // var key = \"qiniu.png\";\n\n        bucketManager.fetch(resUrl, bucket, key, function(err, respBody, respInfo) {\n            if (err) {\n                console.log('七牛云方法出了问题:' + err)\n                reject('七牛云方法出了问题:' + err)\n            } else {\n                if (respInfo.statusCode == 200) {\n                    resolve()\n                    console.log('文件上传成功');\n                }\n            }\n        });\n    })\n}\n")])])]),t("p",[e._v("以上，通过上面5步就将文件上传七牛的方法定义成功。下面看如何调用")]),e._v(" "),t("h2",{attrs:{id:"调用文件上传七牛方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用文件上传七牛方法"}},[e._v("#")]),e._v(" 调用文件上传七牛方法")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// index.js\nconst upload = require('./upload')\n// 生成唯一key方法，引入的一个插件\nconst nanoid = require('nanoid')\n(async () => {\n  var url = 'http://devtools.qiniu.com/qiniu.png'\n  var key = `${nanoid(10)}.jpg`\n  await upload(url, key)\n})()\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);